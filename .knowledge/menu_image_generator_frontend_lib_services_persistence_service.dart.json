{"is_source_file": true, "format": "Dart", "description": "This file implements a PersistenceService class in Dart for a Flutter project, responsible for storing and retrieving MenuRun objects in local storage using the shared_preferences package. It provides methods to save, list, get, delete, and clear menu run histories, managing a cap on the number of stored entries. The class follows singleton pattern to ensure a single instance throughout the app.", "external_files": ["dart:convert", "package:flutter/foundation.dart", "package:shared_preferences/shared_preferences.dart", "package:menu_image_generator_frontend/models/models.dart"], "external_methods": ["SharedPreferences.getInstance", "SharedPreferences.getString", "SharedPreferences.setString", "SharedPreferences.remove", "SharedPreferences.clear (via remove of individual keys and explicit removal of index)"], "published": ["PersistenceService"], "classes": [{"name": "PersistenceService", "description": "Singleton class responsible for persisting MenuRun objects in local storage, maintaining a recency list, and providing CRUD operations for stored runs."}], "methods": [{"name": "_prefs", "description": "Private helper that fetches the SharedPreferences instance."}, {"name": "_runKey", "description": "Constructs the storage key for a specific run ID."}, {"name": "_readIndex", "description": "Reads and decodes the list of run IDs (recency index) from storage."}, {"name": "_writeIndex", "description": "Writes the updated list of run IDs back to storage."}, {"name": "saveRun", "description": "Saves a MenuRun object to storage, updates its position in the recency list, and enforces the maximum entries cap."}, {"name": "getRuns", "description": "Retrieves all stored MenuRun objects ordered by most recent first."}, {"name": "getRunById", "description": "Fetches a specific MenuRun by its ID."}, {"name": "deleteRun", "description": "Deletes a specific run by ID from storage."}, {"name": "clearAll", "description": "Removes all stored runs and clears the index; marked with @visibleForTesting."}], "calls": ["SharedPreferences.getInstance", "prefs.getString", "prefs.setString", "prefs.remove", "jsonDecode", "jsonEncode", "MenuRun.fromJson", "MenuRun.toJsonString", "prefs.getString"], "search-terms": ["PersistenceService", "shared_preferences", "local storage", "menu run history", "recency list", "cap on stored entries", "singleton pattern", "JSON payload"], "state": 2, "file_id": 42, "knowledge_revision": 148, "git_revision": "", "revision_history": [{"138": ""}, {"140": ""}, {"148": ""}], "hash": "f189411654adf4a9385ab7366f5586e6", "format-version": 4, "code-base-name": "menu_image_generator_frontend", "filename": "menu_image_generator_frontend/lib/services/persistence_service.dart"}